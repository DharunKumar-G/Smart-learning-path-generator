// Prisma Schema for Smart Learning Path Generator

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  roadmaps Roadmap[]
}

// Main roadmap generated by AI
model Roadmap {
  id          String   @id @default(cuid())
  title       String
  description String?
  
  // User inputs
  currentSkills String   // What the user already knows
  targetGoal    String   // What they want to achieve
  hoursPerWeek  Int      // Available hours per week
  totalWeeks    Int      // Duration in weeks
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  weeks  Week[]
}

// Weekly breakdown of the roadmap
model Week {
  id          String @id @default(cuid())
  weekNumber  Int
  title       String
  description String?
  goals       String // What to achieve this week
  
  // Relations
  roadmapId String
  roadmap   Roadmap @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  topics    Topic[]
  quizzes   Quiz[]
}

// Individual topics within a week
model Topic {
  id              String  @id @default(cuid())
  name            String
  description     String?
  estimatedHours  Float   // How long this topic takes
  order           Int     // Order within the week
  
  // AI-generated reasoning
  whyThisFirst    String  // Prerequisite reasoning
  searchStrings   String[] // Smart resource finder strings
  
  // Progress tracking
  isCompleted     Boolean @default(false)
  completedAt     DateTime?
  
  // User additions
  notes           String?   // Personal notes for the topic
  isBookmarked    Boolean @default(false)  // Bookmark important topics
  
  // Relations
  weekId String
  week   Week   @relation(fields: [weekId], references: [id], onDelete: Cascade)
}

// Quiz for testing knowledge
model Quiz {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  score     Int?     // User's score (null if not attempted)
  
  // Relations
  weekId    String
  week      Week      @relation(fields: [weekId], references: [id], onDelete: Cascade)
  questions Question[]
}

// Individual quiz question
model Question {
  id            String   @id @default(cuid())
  question      String
  options       String[] // Array of 4 options
  correctIndex  Int      // Index of correct answer (0-3)
  explanation   String?  // Why this is the correct answer
  
  // User's answer
  userAnswer    Int?     // Index of user's selected answer
  
  // Relations
  quizId String
  quiz   Quiz   @relation(fields: [quizId], references: [id], onDelete: Cascade)
}
